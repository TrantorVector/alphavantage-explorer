# Output Formats

This document describes the output file formats and structure generated by the Alpha Vantage Explorer.

## Output Directory Structure

### Bulk Mode

When running bulk mode (`--symbols`), the tool generates:

```
out/
├── index.md                     # Dashboard summary with all symbols
├── market_MARKET_STATUS.md      # Market-wide endpoint reports
├── tickers/
│   ├── AAPL.md                  # Consolidated report for AAPL
│   ├── NVDA.md                  # Consolidated report for NVDA
│   └── ...
└── raw/
    ├── AAPL_OVERVIEW.json       # Raw JSON responses
    ├── AAPL_INCOME_STATEMENT.json
    └── ...
```

### Granular Mode

When running granular commands, the tool generates timestamped files:

```
out/
├── overview_AAPL_20260110_230045.md       # Markdown table (full output)
├── income_statement_NVDA_20260110_231022.md
└── raw/
    ├── overview_AAPL_20260110_230045.json       # Raw JSON
    ├── income_statement_NVDA_20260110_231022.json
    └── earnings_calendar_MSFT_20260110_232015.csv  # CSV format
```

---

## JSON Output

### Raw JSON Files

**Location:** `out/raw/{filename}.json`

Raw JSON files contain the unprocessed API response. These files are:
- Formatted with pretty-printing (indented)
- Saved with all fields intact
- Suitable for programmatic processing
- Limited to 5MB per file (larger files get a placeholder)

**Example:**
```json
{
  "Symbol": "AAPL",
  "AssetType": "Common Stock",
  "Name": "Apple Inc",
  "Exchange": "NASDAQ",
  ...
}
```

### Markdown Tables

**Location:** `out/{filename}.md`

Markdown files contain human-readable tables extracted from JSON responses.

**Table Format:**
- Headers extracted from JSON object keys
- Sorted alphabetically for consistency
- All string values displayed as-is
- Nested objects/arrays are JSON-stringified

**Output Modes:**
- **Bulk mode**: Top 3 rows only (quick overview)
- **Granular mode**: **All rows** (complete data)

**Example Markdown:**

```markdown
## INCOME_STATEMENT - annualReports

| fiscalDateEnding | grossProfit | netIncome | totalRevenue |
| --- | --- | --- | --- |
| 2023-09-30 | 169148000000 | 96995000000 | 383285000000 |
| 2022-09-24 | 170782000000 | 99803000000 | 394328000000 |
| 2021-09-25 | 152836000000 | 94680000000 | 365817000000 |

_(Showing all 3 rows)_
```

**Truncation Note:**
- Bulk mode includes: `_(Showing 3 of 10 total records)_`
- Granular mode includes: `_(Showing all 10 rows)_`

---

## CSV Output

### Raw CSV Files

**Location:** `out/raw/{filename}.csv`

Some endpoints (e.g., `earnings-calendar`) return CSV format directly from the API.

**Characteristics:**
- **No conversion applied** - saved as-is from API
- **No markdown generation** - CSV is the native format
- Headers are preserved from the API response
- Compatible with standard CSV parsers

**Example CSV:**

```csv
symbol,reportDate,estimate
AAPL,2024-01-25,2.10
MSFT,2024-01-30,2.75
NVDA,2024-02-15,5.20
```

### Opening CSV Files

**Command Line:**
```bash
# View with cat
cat out/raw/earnings_calendar_AAPL_20260110_230045.csv

# Pretty print with csvlook (csvkit required)
csvlook out/raw/earnings_calendar_AAPL_20260110_230045.csv

# Open in default application
open out/raw/earnings_calendar_AAPL_20260110_230045.csv  # macOS
xdg-open out/raw/earnings_calendar_AAPL_20260110_230045.csv  # Linux
```

**GUI Applications:**
- Microsoft Excel
- Google Sheets
- LibreOffice Calc
- Any CSV viewer

---

## Filename Conventions

### Bulk Mode
- Pattern: `{SYMBOL}_{ENDPOINT}.{ext}`
- Example: `AAPL_OVERVIEW.json`

### Granular Mode
- Pattern: `{endpoint}_{symbol}_{timestamp}.{ext}`
- Timestamp format: `YYYYMMDD_HHMMSS`
- Example: `overview_AAPL_20260110_230045.json`

---

## File Size Limits

To prevent disk space issues:
- **JSON files >5MB**: Replaced with a placeholder file indicating size limit exceeded
- **CSV files**: No size limit (saved as-is)
- **Markdown files**: No size limit

Placeholder example:
```json
{
  "skipped": true,
  "reason": "File size limit exceeded",
  "max_size_bytes": 5242880,
  "actual_size_bytes": 6543210
}
```

---

## Data Retention

### Bulk Mode
- **Tables**: Top 3 rows
- **Raw JSON**: Full response
- Purpose: Quick overview across multiple endpoints

### Granular Mode
- **Tables**: All rows (complete dataset)
- **Raw JSON/CSV**: Full response
- Purpose: Detailed analysis of specific endpoint

---

## Examples

### Example 1: Overview Command (JSON)

**Command:**
```bash
alphavantage_cli overview --symbol AAPL
```

**Generated Files:**
- `out/overview_AAPL_20260110_230045.md` (Markdown table, all rows)
- `out/raw/overview_AAPL_20260110_230045.json` (Raw JSON)

### Example 2: Earnings Calendar (CSV)

**Command:**
```bash
alphavantage_cli earnings-calendar --symbol AAPL
```

**Generated Files:**
- `out/raw/earnings_calendar_AAPL_20260110_230045.csv` (CSV only, no markdown)

**Console Output:**
```
✓ Saved CSV: out/raw/earnings_calendar_AAPL_20260110_230045.csv (CSV format, no markdown conversion)
```

### Example 3: Bulk Mode

**Command:**
```bash
alphavantage_cli --symbols AAPL,NVDA --out-dir ./report
```

**Generated Files:**
- `report/index.md` (Dashboard)
- `report/tickers/AAPL.md` (All endpoints, top 3 rows each)
- `report/tickers/NVDA.md`
- `report/raw/AAPL_OVERVIEW.json`
- `report/raw/AAPL_INCOME_STATEMENT.json`
- ... (all endpoints for AAPL and NVDA)

---

## Programmatic Access

### Reading JSON
```python
import json

with open('out/raw/overview_AAPL_20260110_230045.json') as f:
    data = json.load(f)
    
print(data['Symbol'])  # AAPL
```

### Reading CSV
```python
import csv

with open('out/raw/earnings_calendar_AAPL_20260110_230045.csv') as f:
    reader = csv.DictReader(f)
    for row in reader:
        print(row['symbol'], row['reportDate'])
```

### Parsing Markdown (optional)
Markdown files are human-readable but can also be parsed programmatically using libraries like `markdown` or `mistune`.
