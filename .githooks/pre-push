#!/bin/bash
# Pre-push hook to ensure code quality before pushing to remote
# Install with: git config core.hooksPath .githooks

set -e  # Exit on first error

echo "ğŸ” Running pre-push checks..."

# Check 1: Formatting
echo "ğŸ“ Checking code formatting..."
if ! cargo fmt --all -- --check; then
    echo "âŒ Code formatting check failed!"
    echo "ğŸ’¡ Run 'cargo fmt --all' to fix formatting issues"
    exit 1
fi
echo "âœ… Formatting check passed"

# Check 2: Clippy
echo "ğŸ” Running clippy lints..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo "âŒ Clippy found issues!"
    echo "ğŸ’¡ Fix clippy warnings before pushing"
    exit 1
fi
echo "âœ… Clippy check passed"

# Check 3: Tests
echo "ğŸ§ª Running tests..."
if ! cargo test --workspace; then
    echo "âŒ Some tests failed!"
    echo "ğŸ’¡ Fix failing tests before pushing"
    exit 1
fi
echo "âœ… All tests passed"

echo "ğŸ‰ All pre-push checks passed! Proceeding with push..."
